<!doctype html>
<title>starchat</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Material+Icons" rel="stylesheet">
<link href="app.css" type="text/css" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1">

<div id="app">
  <aside id="left-menu" @transitionend="transitionend">
  <nav id="navbar">

    <div v-for="net in networks">
      <h2>{{net.id}}</h2>
      <h3 class="topics-header">Channels</h3>
      <ul class="topics-list">
        <li v-for="ctx in net.channels" :key="ctx.id" :class="ctxClassFor(ctx)">
          <router-link
              :to="{name:'context', params:{ network: net.id, type: 'channels', context: ctx.id }}"
              @click.native="closeNav"
              class="topic-item">
              <span class="topic-prefix" v-if="ctx.prefix">{{ctx.prefix}}</span>
              {{ctx.mainName}}
          </router-link>
        </li>

        <h3 class="topics-header">Queries</h3>
        <li v-for="ctx in net.queries" :key="ctx.id" :class="ctxClassFor(ctx)">
          <router-link
              :to="{name:'context', params:{ network: net.id, type: 'queries', context: ctx.id }}"
              @click.native="closeNav"
              class="topic-item">
              {{ctx.id}}
          </router-link>
        </li>

        <li>
          <router-link
              :to="{name:'context', params:{ network: net.id, type: 'server', context: 'server-log' }}"
              @click.native="closeNav"
              class="topic-item">
              <span class="topic-prefix">~</span>
              server
          </router-link>
        </li>

        <!--li>
          <a href={{newTopicUrl}} class="new-topic">new topic...</a>
        </li-->
      </ul>
    </div>

  </nav>
  </aside>

  <router-view></router-view>
</div>

<script type="text/x-template" id="rich-activity">
  <li class="rich-activity activity-entry">
    <div class="author" v-if="newAuthor">
      <div class="author-avatar"
          :style="'background-color:' + authorColor"
        >{{ author[0] }}</div>
      <span class="author-name"
          :style="'color:' + authorColor"
        >{{ author }}</span>
    </div>
    <span class="time">{{ timestamp }}</span>
    <span :class="'message '+enriched.classes.join(' ')">
      <span
          v-for="s in enriched.segments"
          :key="s.idx"
          :style="s.css"
        ><a v-if="s.type==='link'" :href="s.text" :style="s.css" target="_blank">{{s.text}}</a
        ><code v-if="s.type==='code'" :style="s.css">{{s.text}}</code
        ><template v-if="!s.type">{{s.text}}</template
      ></span>
    </span>
  </li>
</script>

<script type="text/x-template" id="status-activity">
  <li class="status-activity activity-entry">
    <span class="time">{{ timestamp }}</span>
    <span class="status">{{ text }}</span>
  </li>
</script>

<script type="text/x-template" id="view-context">
  <div id="contents">
    <header id="topic-header">

      <div id="th-left">
        <a href="#menu" class="menu" @click.prevent="openMenu">
          <i class="material-icons">menu</i>
        </a>

        <h3>{{ name }}</h3>
        <div id="th-bottom">
          <!-- star button -->
          <!-- member count -->
          <span class="topic">{{ topic }}</span>
        </div>
      </div>

      <div id="th-right">
        <!-- menu -->
      </div>
    </header>

    <div class="main-context">
      <div class="scrollback" ref="log">
        <log-partition
            v-for="part in logParts"
            :key="part.id"
            :partId="part.id"
            :path="logPath + '/' + part.id"
            :isLive="part.id == currentDay"
            @newMessage="tickleAutoScroll"
            @reachedHorizon="loadPreviousPart"
          />
      </div>

      <aside class="member-list">
        <ul>
          <li v-for="n in memberList" :key="n">{{n}}</li>
        </ul>
      </aside>
    </div>

    <div class="new-unread-below"
        v-if="newMessageCount > 0"
        @click="scrollDown">
      {{newMessageCount}} new messages below ðŸ‘‡
    </div>

    <send-message :channelName="name" :networkName="networkName" :chanPath="path" :members="memberList" />
  </div>
</script>

<script type="text/x-template" id="log-partition">
  <div class="log-partition" :class="{'live-partition': isLive}">
    <h5 class="partition-header">{{partId}}</h5>

    <div class="load-older"
        v-if="oldestId > 0"
        @click="loadOlder">
      load more scrollback...
    </div>

    <div class="log-empty"
        v-if="!isUpdating && entries.length === 0">
      no messages
    </div>

    <ul class="log-lines">
      <component :is="entry.component"
          v-for="entry in entries"
          :key="entry.id"
          :msg="entry"
        />
    </ul>
  </div>
</script>

<script type="text/x-template" id="send-message">
  <form @submit.prevent="submit" id="message-box">
    <input type="text" name="body" autocomplete="off" v-model="message" required
        @keydown="onKeyDown"
         :placeholder="'Message ' + channelName" />
    <button type="submit">
      <i class="material-icons">send</i>
    </button>
  </form>
</script>

<script src="https://unpkg.com/vue"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="/~system/js-core/combined.js"></script>
<script src="colorize.js"></script>
<script src="app.js"></script>
